<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hidden {
            display: none !important;
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 90%;
            margin: 1rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            opacity: 0.9;
        }

        .btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
            display: inline-block;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .settings {
            margin: 1.5rem 0;
            text-align: left;
        }

        .setting-item {
            margin: 1rem 0;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        /* –£–ë–ò–†–ê–ï–ú –ë–ï–õ–£–Æ –ì–†–ê–ù–ò–¶–£ –°–í–ï–†–•–£ */
        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.9); /* –î–µ–ª–∞–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–Ω—ã–º */
            z-index: 100;
            /* –£–ë–ò–†–ê–ï–ú border-bottom */
        }

        .timer {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
        }

        .timer.low-time {
            color: #ff6b6b;
            animation: pulse 0.8s infinite;
        }

        .target {
            font-size: 1.3rem;
            text-align: center;
            color: #fff;
        }

        .target-emoji {
            font-size: 2rem;
            display: block;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .level {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .game-area {
            width: 100%;
            height: 100%;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        /* –§–û–ù–ê–†–ò–ö –ò –õ–£–ü–ê */
        .flashlight {
            position: absolute;
            pointer-events: none;
            z-index: 10;
            transition: transform 0.1s ease;
        }

        .flashlight-beam {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0.2) 30%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 70%
            );
            filter: blur(5px);
        }

        /* –õ–£–ü–ê - –ß–ï–¢–ö–ò–ô –ö–†–£–ì */
        .magnifier-beam {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 255, 255, 0.4) 0%,
                rgba(255, 255, 255, 0.3) 40%,
                rgba(255, 255, 255, 0.2) 60%,
                transparent 80%
            );
            border: 2px solid rgba(255, 255, 255, 0.8);
            filter: none;
        }

        .tool-icon {
            position: absolute;
            font-size: 2rem;
            z-index: 15;
            pointer-events: none;
            filter: drop-shadow(0 0 8px yellow);
        }

        .emoji {
            position: absolute;
            font-size: 3rem;
            z-index: 5;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .emoji.visible {
            opacity: 1;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            z-index: 20;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .instructions {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            z-index: 20;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —Ñ–æ–Ω–∞—Ä–∏–∫–∞ */
        .chinese-lantern .flashlight-beam {
            background: radial-gradient(
                circle,
                rgba(255, 100, 100, 0.4) 0%,
                rgba(255, 100, 100, 0.3) 30%,
                rgba(255, 100, 100, 0.2) 50%,
                transparent 70%
            );
        }

        /* –î–ª—è –ª–µ–≤—à–µ–π - –∏–∫–æ–Ω–∫–∞ —Ñ–æ–Ω–∞—Ä–∏–∫–∞ —Å–ª–µ–≤–∞ */
        .left-handed .tool-icon {
            transform: scaleX(-1);
            left: -30px;
        }

        /* –î–ª—è –ø—Ä–∞–≤—à–µ–π - –∏–∫–æ–Ω–∫–∞ —Ñ–æ–Ω–∞—Ä–∏–∫–∞ —Å–ø—Ä–∞–≤–∞ */
        .right-handed .tool-icon {
            right: -30px;
        }

        /* –≠–∫—Ä–∞–Ω –ø–∞—É–∑—ã */
        .pause-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .pause-content {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
        .level-indicator {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            z-index: 101;
            text-align: center;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ–Ω—ã —É—Ä–æ–≤–Ω—è */
        .level-up {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 20px;
            z-index: 1000;
            animation: levelUpAnimation 1.5s ease-out;
            text-align: center;
        }

        @keyframes levelUpAnimation {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ –∏–≥—Ä—ã */
        .game-type-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            z-index: 101;
        }
    </style>
</head>
<body>
    <!-- –ù–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="startScreen" class="screen">
        <div class="container">
            <h1>üïµÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ</h1>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ–Ω–∞—Ä–∏–∫ –∏–ª–∏ –ª—É–ø—É —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã!</p>
            <button id="startButton" class="btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button id="settingsButton" class="btn btn-secondary">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsScreen" class="screen hidden">
        <div class="container">
            <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            
            <div class="settings">
                <div class="setting-item">
                    <span class="setting-label">–†—É–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</span>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="hand" value="right" checked>
                            <span>–ü—Ä–∞–≤—à–∞ üîç</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="hand" value="left">
                            <span>–õ–µ–≤—à–∞ üîé</span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <span class="setting-label">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∏—Å–∫–∞:</span>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="tool" value="flashlight" checked>
                            <span>–§–æ–Ω–∞—Ä–∏–∫ üî¶</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="tool" value="magnifier">
                            <span>–õ—É–ø–∞ üîç</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <button id="backButton" class="btn">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="gameScreen" class="screen hidden">
        <div class="game-header">
            <div class="timer" id="timer">40—Å</div>
            <div class="target">
                –¶–µ–ª—å: <span class="target-emoji" id="targetEmoji">üîç</span>
            </div>
            <div class="level">–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
        </div>

        <div class="game-type-indicator" id="gameTypeIndicator">üî¶ –§–æ–Ω–∞—Ä–∏–∫</div>
        <div class="level-indicator" id="levelIndicator">–ù–∞–π–¥–∏—Ç–µ —Ü–µ–ª—å!</div>
        
        <div id="gameArea" class="game-area">
            <!-- –≠–º–æ–¥–∑–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∑–¥–µ—Å—å -->
        </div>
        
        <!-- –ò–ù–°–¢–†–£–ú–ï–ù–¢ –ü–û–ò–°–ö–ê -->
        <div class="flashlight" id="searchTool">
            <div class="flashlight-beam" id="toolBeam"></div>
            <div class="tool-icon" id="toolIcon">üî¶</div>
        </div>
        
        <div class="instructions">
            –í–æ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –ø–æ —ç–∫—Ä–∞–Ω—É ‚Ä¢ –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–π —ç–º–æ–¥–∑–∏
        </div>
        
        <div class="controls">
            <button class="control-btn" id="pauseButton">‚è∏Ô∏è</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø–∞—É–∑—ã -->
        <div id="pauseScreen" class="pause-overlay hidden">
            <div class="pause-content">
                <h2>‚è∏Ô∏è –ü–∞—É–∑–∞</h2>
                <p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
                <button id="resumeButton" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                <button id="quitButton" class="btn btn-secondary">–í—ã–π—Ç–∏ –≤ –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div id="resultScreen" class="screen hidden">
        <div class="container">
            <h1>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h1>
            <p id="resultMessage"></p>
            <button id="restartButton" class="btn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button id="menuButton" class="btn btn-secondary">–ú–µ–Ω—é</button>
        </div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–≥—Ä—ã
        const startScreen = document.getElementById('startScreen');
        const settingsScreen = document.getElementById('settingsScreen');
        const gameScreen = document.getElementById('gameScreen');
        const resultScreen = document.getElementById('resultScreen');
        const pauseScreen = document.getElementById('pauseScreen');
        const startButton = document.getElementById('startButton');
        const settingsButton = document.getElementById('settingsButton');
        const backButton = document.getElementById('backButton');
        const restartButton = document.getElementById('restartButton');
        const menuButton = document.getElementById('menuButton');
        const pauseButton = document.getElementById('pauseButton');
        const resumeButton = document.getElementById('resumeButton');
        const quitButton = document.getElementById('quitButton');
        
        const gameArea = document.getElementById('gameArea');
        const timerElement = document.getElementById('timer');
        const targetEmoji = document.getElementById('targetEmoji');
        const levelElement = document.getElementById('level');
        const levelIndicator = document.getElementById('levelIndicator');
        const gameTypeIndicator = document.getElementById('gameTypeIndicator');
        const resultMessage = document.getElementById('resultMessage');
        const searchTool = document.getElementById('searchTool');
        const toolBeam = document.getElementById('toolBeam');
        const toolIcon = document.getElementById('toolIcon');

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
        const gameTime = 40;
        let timeLeft = gameTime;
        let currentLevel = 1;
        let gameTimer;
        let isGameRunning = false;
        let isPaused = false;
        let currentTarget = '';
        let emojis = [];
        let settings = {
            hand: 'right',
            tool: 'flashlight' // flashlight –∏–ª–∏ magnifier
        };

        // –¢–∏–ø—ã —É—Ä–æ–≤–Ω–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
        const levelTypes = {
            1: { name: "–§–æ–Ω–∞—Ä–∏–∫", tool: "flashlight", emojis: ['üîë', 'üíé', 'üì±', 'üíç'], radius: 180 },
            2: { name: "–õ—É–ø–∞", tool: "magnifier", emojis: ['üî´', 'üí∞', 'üìú', 'üé≠'], radius: 180 },
            3: { name: "–§–æ–Ω–∞—Ä–∏–∫+", tool: "flashlight", emojis: ['‚ö∞Ô∏è', 'üïµÔ∏è', 'üß©', 'üéØ'], radius: 170 },
            4: { name: "–õ—É–ø–∞+", tool: "magnifier", emojis: ['üèÜ', '‚≠ê', 'üîî', 'üé™'], radius: 170 },
            5: { name: "–£–ª—å—Ç—Ä–∞", tool: "flashlight", emojis: ['üé≤', 'üëë', 'üíº', 'üóùÔ∏è'], radius: 160 },
            6: { name: "–≠–∫—Å–ø–µ—Ä—Ç", tool: "magnifier", emojis: ['üëª', 'üëΩ', 'ü§ñ', 'üéÉ'], radius: 160 },
            7: { name: "–ú–∞—Å—Ç–µ—Ä", tool: "flashlight", emojis: ['üíÄ', 'üëæ', 'ü¶á', 'üç≠'], radius: 150 },
            8: { name: "–õ–µ–≥–µ–Ω–¥–∞", tool: "magnifier", emojis: ['üéÅ', 'üí£', 'üöÄ', 'üåà'], radius: 150 }
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        startButton.addEventListener('click', () => startScreen.classList.add('hidden') || startGame());
        settingsButton.addEventListener('click', () => startScreen.classList.add('hidden') || settingsScreen.classList.remove('hidden'));
        backButton.addEventListener('click', () => settingsScreen.classList.add('hidden') || startScreen.classList.remove('hidden'));
        restartButton.addEventListener('click', startGame);
        menuButton.addEventListener('click', () => resultScreen.classList.add('hidden') || startScreen.classList.remove('hidden'));
        pauseButton.addEventListener('click', pauseGame);
        resumeButton.addEventListener('click', resumeGame);
        // –ò–°–ü–†–ê–í–õ–Ø–ï–ú –ó–ê–í–ò–°–ê–ù–ò–ï –ü–†–ò –í–´–•–û–î–ï
        quitButton.addEventListener('click', () => {
            pauseScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            isGameRunning = false;
            clearInterval(gameTimer);
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function loadSettings() {
            const handSetting = document.querySelector('input[name="hand"]:checked');
            const toolSetting = document.querySelector('input[name="tool"]:checked');
            
            settings.hand = handSetting ? handSetting.value : 'right';
            settings.tool = toolSetting ? toolSetting.value : 'flashlight';
            
            updateToolAppearance();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        function updateToolAppearance() {
            searchTool.className = 'flashlight';
            
            if (settings.tool === 'magnifier') {
                toolBeam.className = 'magnifier-beam';
                toolIcon.textContent = 'üîç';
                gameTypeIndicator.textContent = 'üîç –õ—É–ø–∞';
            } else {
                toolBeam.className = 'flashlight-beam';
                toolIcon.textContent = 'üî¶';
                gameTypeIndicator.textContent = 'üî¶ –§–æ–Ω–∞—Ä–∏–∫';
            }
            
            if (settings.hand === 'left') {
                searchTool.classList.add('left-handed');
            } else {
                searchTool.classList.add('right-handed');
            }
        }

        // –ü–∞—É–∑–∞ –∏–≥—Ä—ã
        function pauseGame() {
            isPaused = true;
            isGameRunning = false;
            clearInterval(gameTimer);
            pauseScreen.classList.remove('hidden');
        }

        // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏–≥—Ä—ã
        function resumeGame() {
            isPaused = false;
            isGameRunning = true;
            pauseScreen.classList.add('hidden');
            startTimer();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        let isTouching = false;
        let lastTouch = { x: 0, y: 0 };

        gameArea.addEventListener('touchstart', (e) => {
            if (isPaused) return;
            e.preventDefault();
            isTouching = true;
            lastTouch = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            moveSearchTool(e.touches[0]);
        });

        gameArea.addEventListener('touchmove', (e) => {
            if (isPaused) return;
            e.preventDefault();
            if (isTouching && e.touches[0]) {
                const touch = e.touches[0];
                const deltaX = Math.abs(touch.clientX - lastTouch.x);
                const deltaY = Math.abs(touch.clientY - lastTouch.y);
                
                if (deltaX > 3 || deltaY > 3) {
                    lastTouch = { x: touch.clientX, y: touch.clientY };
                    moveSearchTool(touch);
                }
            }
        });

        gameArea.addEventListener('touchend', (e) => {
            e.preventDefault();
            isTouching = false;
        });

        // –î–≤–∏–∂–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ–∏—Å–∫–∞
        function moveSearchTool(touch) {
            if (!isGameRunning) return;
            
            const x = touch.clientX - 100;
            const y = touch.clientY - 100;
            
            searchTool.style.left = x + 'px';
            searchTool.style.top = y + 'px';
            
            showEmojisInRadius(x + 100, y + 100);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–º–æ–¥–∑–∏ –≤ —Ä–∞–¥–∏—É—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        function showEmojisInRadius(centerX, centerY) {
            const levelData = levelTypes[Math.min(currentLevel, 8)];
            const radius = levelData.radius;
            
            emojis.forEach(emoji => {
                const rect = emoji.getBoundingClientRect();
                const emojiX = rect.left + rect.width / 2;
                const emojiY = rect.top + rect.height / 2;
                
                const distance = Math.sqrt(
                    Math.pow(emojiX - centerX, 2) + 
                    Math.pow(emojiY - centerY, 2)
                );
                
                if (distance < radius) {
                    emoji.classList.add('visible');
                    
                    if (emoji.textContent === currentTarget) {
                        completeLevel();
                    }
                } else {
                    emoji.classList.remove('visible');
                }
            });
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            loadSettings();
            
            startScreen.classList.add('hidden');
            settingsScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            pauseScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            timeLeft = gameTime;
            currentLevel = 1;
            isGameRunning = true;
            isPaused = false;
            
            timerElement.textContent = `${timeLeft}—Å`;
            timerElement.classList.remove('low-time');
            levelElement.textContent = currentLevel;
            
            gameArea.innerHTML = '';
            emojis = [];
            
            generateLevel();
            startTimer();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è
        function generateLevel() {
            gameArea.innerHTML = '';
            emojis = [];
            
            const levelData = levelTypes[Math.min(currentLevel, 8)];
            const availableEmojis = levelData.emojis;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É—Ä–æ–≤–Ω—è
            settings.tool = levelData.tool;
            updateToolAppearance();
            
            levelIndicator.textContent = `–£—Ä–æ–≤–µ–Ω—å ${currentLevel}: ${levelData.name}`;
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Ü–µ–ª–µ–≤–æ–µ —ç–º–æ–¥–∑–∏
            currentTarget = availableEmojis[Math.floor(Math.random() * availableEmojis.length)];
            targetEmoji.textContent = currentTarget;
            
            const usedPositions = [];
            const emojiCount = 4 + Math.floor(currentLevel / 2);
            
            for (let i = 0; i < emojiCount; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                
                const emojiType = i === 0 ? currentTarget : 
                                 availableEmojis[Math.floor(Math.random() * availableEmojis.length)];
                emoji.textContent = emojiType;
                
                let x, y;
                let attempts = 0;
                const headerHeight = 70;
                const safeMargin = 30;
                
                do {
                    x = safeMargin + Math.random() * (window.innerWidth - 2 * safeMargin);
                    y = headerHeight + safeMargin + Math.random() * (window.innerHeight - headerHeight - 2 * safeMargin - 100);
                    attempts++;
                } while (isTooClose(x, y, usedPositions) && attempts < 100);
                
                usedPositions.push({x, y});
                
                emoji.style.left = x + 'px';
                emoji.style.top = y + 'px';
                
                gameArea.appendChild(emoji);
                emojis.push(emoji);
            }
        }

        function isTooClose(x, y, positions) {
            for (const pos of positions) {
                const distance = Math.sqrt(Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2));
                if (distance < 100) {
                    return true;
                }
            }
            return false;
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        function completeLevel() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            const levelUp = document.createElement('div');
            levelUp.className = 'level-up';
            levelUp.textContent = `üéâ –£—Ä–æ–≤–µ–Ω—å ${currentLevel} –ø—Ä–æ–π–¥–µ–Ω! üéâ`;
            gameArea.appendChild(levelUp);
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                levelUp.remove();
                currentLevel++;
                levelElement.textContent = currentLevel;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –∑–∞ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
                timeLeft += 3;
                timerElement.textContent = `${timeLeft}—Å`;
                
                generateLevel();
            }, 1500);
        }

        // –¢–∞–π–º–µ—Ä
        function startTimer() {
            clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                if (!isPaused && isGameRunning) {
                    timeLeft--;
                    timerElement.textContent = `${timeLeft}—Å`;
                    
                    if (timeLeft <= 10) {
                        timerElement.classList.add('low-time');
                    }
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }
            }, 1000);
        }

        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function endGame() {
            isGameRunning = false;
            clearInterval(gameTimer);
            
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            let message = `–í—ã –ø—Ä–æ—à–ª–∏ ${currentLevel - 1} —É—Ä–æ–≤–Ω–µ–π! `;
            if (currentLevel - 1 <= 3) {
                message += "–ù–æ–≤–∏—á–æ–∫-–¥–µ—Ç–µ–∫—Ç–∏–≤!";
            } else if (currentLevel - 1 <= 6) {
                message += "–û–ø—ã—Ç–Ω—ã–π —Å—ã—â–∏–∫!";
            } else if (currentLevel - 1 <= 8) {
                message += "–í–µ–ª–∏–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤!";
            } else {
                message += "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–∞—Å—Ç–µ—Ä!";
            }
            
            resultMessage.textContent = message;
        }

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ä–∞–∑–º–µ—Ä—É —ç–∫—Ä–∞–Ω–∞
        function handleResize() {
            if (isGameRunning) {
                generateLevel();
            }
        }

        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        console.log('–î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω! –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è');
    </script>
</body>
</html>
